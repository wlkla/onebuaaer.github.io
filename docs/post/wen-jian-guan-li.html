<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    <script src='https://onebuaaer.us.kg/Vercount.js'></script>
    <link rel="icon" href="https://telegraph-image-6b4.pages.dev/file/3a89e862ad5a60a260608.jpg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="# 文件管理

## 文件系统基础

### 文件的基本概念

1. 文件：以硬盘为载体的存储在计算机上的信息集合

2. 在系统运行时计算机以进程为基本单位进行资源的调度与分配

3. 在用户进行的输入输出中，以文件为基本单位

4. 文件的组成：

   ```mermaid
   graph LR
   	A(文件)-->B(存储空间中的数据)
   	A-->C(分类和索引的信息)
   	A-->D(访问权限的信息)
   ```

5. 文件的结构：

   - 数据项：是文件系统中最低级的数据组织形式，可分为两种类型
     - 基本数据项：用于描述一个对象的某种属性的一个值，是数据中的最小逻辑单位
     - 组合数据项：有多个基本数据项组成
   - 记录：是一组相关的数据项的集合，用于描述一个对象在某方面的属性
   - 文件：是指由创建者所定义的、具有文件名的一组相关元素的集合
     - 有结构文件：由若干相似的记录组成
     - 无结构文件：一个字符流

6. 文件的属性

   - 名称
   - 类型
   - 创建者
   - 所有者
   - 位置
   - 大小
   - 保护：对文件进行保护的访问控制信息
   - 创建时间、最后一次修改时间和最后一次存取时间

7. 文件的分类

   ```mermaid
   graph LR
   	A(文件)-->B(按性质和用途)
   	A-->C(按数据的形式)
   	A-->D(按存取控制属性)
   	A-->E(按组织形式和处理方式)
   	B-->F(系统文件)
   	B-->G(用户文件)
   	B-->H(库文件)
   	C-->I(源码文件)
   	C-->J(目标文件)
   	C-->K(可执行文件)
   	D-->L(可执行文件)
   	D-->M(制度文件)
   	D-->N(读写文件)
   	E-->O(普通文件)
   	E-->P(目录文件)
   	E-->Q(特殊文件)
   ```

### 文件控制块和索引节点

1. 文件控制块FCB是用来存放控制文件需要的各种信息的数据结构，以实现按名存取

2. 文件与FCB一一对应，FCB的有序集合称为**文件目录**，一个FCB就是一个文件目录项

3. 一个文件目录也被视为一个文件，称为目录文件

4. FCB主要包含以下信息

   - 基本信息：文件名、文件的物理地址、文件的逻辑结构、文件的物理结构
   - 存取控制信息：文件主/标准用户/一般用户的存取权限等
   - 使用信息：文件建立时间，上次修改时间等

5. 在索引目录时，只用到了文件名，文件的其他描述信息不会用到，也不需要调入内存，因此有的系统便采用了文件名和文件描述信息分离的方法，是文件描述信息单独形成一个称为索引节点的数据结构，简称**i节点**。">
<meta property="og:title" content="文件管理">
<meta property="og:description" content="# 文件管理

## 文件系统基础

### 文件的基本概念

1. 文件：以硬盘为载体的存储在计算机上的信息集合

2. 在系统运行时计算机以进程为基本单位进行资源的调度与分配

3. 在用户进行的输入输出中，以文件为基本单位

4. 文件的组成：

   ```mermaid
   graph LR
   	A(文件)-->B(存储空间中的数据)
   	A-->C(分类和索引的信息)
   	A-->D(访问权限的信息)
   ```

5. 文件的结构：

   - 数据项：是文件系统中最低级的数据组织形式，可分为两种类型
     - 基本数据项：用于描述一个对象的某种属性的一个值，是数据中的最小逻辑单位
     - 组合数据项：有多个基本数据项组成
   - 记录：是一组相关的数据项的集合，用于描述一个对象在某方面的属性
   - 文件：是指由创建者所定义的、具有文件名的一组相关元素的集合
     - 有结构文件：由若干相似的记录组成
     - 无结构文件：一个字符流

6. 文件的属性

   - 名称
   - 类型
   - 创建者
   - 所有者
   - 位置
   - 大小
   - 保护：对文件进行保护的访问控制信息
   - 创建时间、最后一次修改时间和最后一次存取时间

7. 文件的分类

   ```mermaid
   graph LR
   	A(文件)-->B(按性质和用途)
   	A-->C(按数据的形式)
   	A-->D(按存取控制属性)
   	A-->E(按组织形式和处理方式)
   	B-->F(系统文件)
   	B-->G(用户文件)
   	B-->H(库文件)
   	C-->I(源码文件)
   	C-->J(目标文件)
   	C-->K(可执行文件)
   	D-->L(可执行文件)
   	D-->M(制度文件)
   	D-->N(读写文件)
   	E-->O(普通文件)
   	E-->P(目录文件)
   	E-->Q(特殊文件)
   ```

### 文件控制块和索引节点

1. 文件控制块FCB是用来存放控制文件需要的各种信息的数据结构，以实现按名存取

2. 文件与FCB一一对应，FCB的有序集合称为**文件目录**，一个FCB就是一个文件目录项

3. 一个文件目录也被视为一个文件，称为目录文件

4. FCB主要包含以下信息

   - 基本信息：文件名、文件的物理地址、文件的逻辑结构、文件的物理结构
   - 存取控制信息：文件主/标准用户/一般用户的存取权限等
   - 使用信息：文件建立时间，上次修改时间等

5. 在索引目录时，只用到了文件名，文件的其他描述信息不会用到，也不需要调入内存，因此有的系统便采用了文件名和文件描述信息分离的方法，是文件描述信息单独形成一个称为索引节点的数据结构，简称**i节点**。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://onebuaaer.us.kg//post/wen-jian-guan-li.html">
<meta property="og:image" content="https://telegraph-image-6b4.pages.dev/file/3a89e862ad5a60a260608.jpg">
<title>文件管理</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">文件管理</h1>
<div class="title-right">
    <a href="https://onebuaaer.us.kg/" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/wlkla/onebuaaer.github.io/issues/5" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>文件管理</h1>
<h2>文件系统基础</h2>
<h3>文件的基本概念</h3>
<ol>
<li>
<p>文件：以硬盘为载体的存储在计算机上的信息集合</p>
</li>
<li>
<p>在系统运行时计算机以进程为基本单位进行资源的调度与分配</p>
</li>
<li>
<p>在用户进行的输入输出中，以文件为基本单位</p>
</li>
<li>
<p>文件的组成：</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>存储空间中的数据<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>分类和索引的信息<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>访问权限的信息<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
<li>
<p>文件的结构：</p>
<ul>
<li>数据项：是文件系统中最低级的数据组织形式，可分为两种类型
<ul>
<li>基本数据项：用于描述一个对象的某种属性的一个值，是数据中的最小逻辑单位</li>
<li>组合数据项：有多个基本数据项组成</li>
</ul>
</li>
<li>记录：是一组相关的数据项的集合，用于描述一个对象在某方面的属性</li>
<li>文件：是指由创建者所定义的、具有文件名的一组相关元素的集合
<ul>
<li>有结构文件：由若干相似的记录组成</li>
<li>无结构文件：一个字符流</li>
</ul>
</li>
</ul>
</li>
<li>
<p>文件的属性</p>
<ul>
<li>名称</li>
<li>类型</li>
<li>创建者</li>
<li>所有者</li>
<li>位置</li>
<li>大小</li>
<li>保护：对文件进行保护的访问控制信息</li>
<li>创建时间、最后一次修改时间和最后一次存取时间</li>
</ul>
</li>
<li>
<p>文件的分类</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>按性质和用途<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>按数据的形式<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>按存取控制属性<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>按组织形式和处理方式<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">B</span><span class="pl-k">--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>系统文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">B</span><span class="pl-k">--&gt;</span><span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>用户文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">B</span><span class="pl-k">--&gt;</span><span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>库文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">C</span><span class="pl-k">--&gt;</span><span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>源码文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">C</span><span class="pl-k">--&gt;</span><span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>目标文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">C</span><span class="pl-k">--&gt;</span><span class="pl-ent">K</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>可执行文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">D</span><span class="pl-k">--&gt;</span><span class="pl-ent">L</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>可执行文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">D</span><span class="pl-k">--&gt;</span><span class="pl-ent">M</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>制度文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">D</span><span class="pl-k">--&gt;</span><span class="pl-ent">N</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>读写文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">E</span><span class="pl-k">--&gt;</span><span class="pl-ent">O</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>普通文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">E</span><span class="pl-k">--&gt;</span><span class="pl-ent">P</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>目录文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">E</span><span class="pl-k">--&gt;</span><span class="pl-ent">Q</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>特殊文件<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
</ol>
<h3>文件控制块和索引节点</h3>
<ol>
<li>
<p>文件控制块FCB是用来存放控制文件需要的各种信息的数据结构，以实现按名存取</p>
</li>
<li>
<p>文件与FCB一一对应，FCB的有序集合称为<strong>文件目录</strong>，一个FCB就是一个文件目录项</p>
</li>
<li>
<p>一个文件目录也被视为一个文件，称为目录文件</p>
</li>
<li>
<p>FCB主要包含以下信息</p>
<ul>
<li>基本信息：文件名、文件的物理地址、文件的逻辑结构、文件的物理结构</li>
<li>存取控制信息：文件主/标准用户/一般用户的存取权限等</li>
<li>使用信息：文件建立时间，上次修改时间等</li>
</ul>
</li>
<li>
<p>在索引目录时，只用到了文件名，文件的其他描述信息不会用到，也不需要调入内存，因此有的系统便采用了文件名和文件描述信息分离的方法，是文件描述信息单独形成一个称为索引节点的数据结构，简称<strong>i节点</strong>。在文件目录中的每个目录项仅由文件名和相应的索引节点号或索引节点指针构成</p>
</li>
<li>
<p>磁盘索引节点：是指存放在磁盘上的索引节点。每个文件有一个唯一的磁盘索引节点，主要包括：</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>磁盘索引节点<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件主标识符<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>拥有该文件的个人或组织的标识符<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件类型<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>包括普通文件、目录文件或特别文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件存取权限<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">K</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>各类用户对该文件的存取权限<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件物理地址<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">L</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>每个索引节点含13个地址项，给出文件所在盘块的编号<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件长度<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">M</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>以字节为单位的文件长度<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件链接计数<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">N</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>系统中指向该文件的文件名的指针计数<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件存取时间<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">O</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件最近被进程存取、修改的时间及索引节点最近被修改的时间<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
<li>
<p>内存索引节点：只存放在内存中的索引节点。当文件被打开时，要将磁盘索引节点复制到内存的索引节点中，便于以后使用。在磁盘索引节点的基础上增加了以下内容：</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>增加的内容<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>索引节点号<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>用于标识内存索引节点<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>状态<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>指示i节点是否上锁或被修改<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>访问计数<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>每当有一进程要访问此节点时，计数+1；访问结束-1<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>逻辑设备号<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件所属文件系统的逻辑设备号<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>链接指针<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">K</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>设置分别指向空闲链表和散列队列的指针<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
</ol>
<h3>文件的操作</h3>
<ol>
<li>
<p>文件的基本操作</p>
<ul>
<li>创建文件：为新文件分配外存空间，在目录中为之创建一个目录项</li>
<li>删除文件：根据文件名查找目录，删除指定文件对应的目录项和文件控制块，然后回收该文件所占用的存储空间</li>
<li>读文件：根据文件名查找目录，找到指定文件的目录项后，从中得到被读文件在外存中的地址；在目录项中，还有一个指针用于对文件进行读操作</li>
<li>写文件：根据文件名查找目录，找到指定文件的目录项后；再利用目录项中的写指针对文件进行写操作。每当发生写操作时，便更新写指针</li>
</ul>
</li>
<li>
<p>文件打开的过程</p>
<ul>
<li>当用户首次对某文件发出操作请求时，须先利用系统调用open将该文件打开。系统维护一个包含所有打开文件信息的表，称为<strong>打开文件表</strong>。</li>
<li>“打开”：系统检索到指定文件的目录项后，将该目录项从外存复制到内存中的打开文件表的一个表目中，并将该表目的索引号返回给用户</li>
<li>当用户再次对该文件发出操作请求时，可通过索引号在打开文件表中查找到文件信息，从而节省大量的检索开销</li>
<li>当文件不再使用时，可利用系统调用close关闭它，则系统将会从打开文件表中删除这一表目</li>
</ul>
</li>
<li>
<p>文件关闭的过程</p>
<ul>
<li>在多个进程可以同时打开文件的操作系统中，通常采用两级表：整个系统表和每个进程表</li>
<li>整个系统的打开文件表包含与进程无关信息，每个进程的打开文件表保存的是进程对文件的实用信息，并包含指向系统表中适当条目的指针</li>
<li>一旦有进程打开了一个文件，系统表就包含该文件的条目。当另一个进程执行调用open时，是在其打开文件表中增加了一个条目，并指向系统表的相应条目</li>
<li>系统打开文件表为每个文件关联一个<strong>打开计数器</strong>，用于记录多少进程打开了该文件。当文件不再使用时，利用系统调用close关闭它，会删除单个进程的打开文件表中的相应表目，系统表中的相应打开计数器会递减。当打开计数器为0时，表示该文件不再被使用，并且可从系统表中删除相应条目</li>
</ul>
</li>
<li>
<p>文件名不必是打开文件表中的一部分，因为一旦完成对FCB在磁盘上的定位，系统就不再使用文件名。只要文件未被关闭，所有文件操作都是通过文件描述符/索引号来进行</p>
</li>
<li>
<p>每个打开文件都具有如下关联信息</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件关联信息<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件指针<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>系统跟踪上次的读写位置作为当前文件位置的指针<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件打开计数<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>计数器跟踪当前文件打开和关闭的数量<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件磁盘位置<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>大多数文件操作要求系统修改文件数据<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>访问权限<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>每个进程打开文件都需要一个访问模式<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
</ol>
<h3>文件保护</h3>
<ol>
<li>
<p>文件保护措施</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">TB</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件保护<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>口令保护<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>加密保护<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>访问控制<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
<ul>
<li>口令和加密是为了防止用户文件被他人存取或窃取；访问控制则用于控制用户对文件的访问方式</li>
</ul>
</li>
<li>
<p>加以控制的访问类型主要由以下几种：</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>访问类型<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>读<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">H</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>从文件中读<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>写<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">I</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>向文件中写<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>执行<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">J</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>将文件装入内存中并执行<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>添加<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">K</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>将新信息添加到文件<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>删除<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">L</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>删除文件，释放空间<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>列表清单<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">M</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>列出文件名和文件属性<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
<li>
<p>解决访问控制最常用的方法是根据用户身份进行控制，实现基于身份访问的最普通的方法是为每个文件和目录增加一个访问控制列表ACL，以规定每个用户名及其所允许的访问类型</p>
<p>优点：可以使用复杂的访问方法</p>
<p>缺点：长度无法预计并且可能导致复杂的空间管理</p>
</li>
<li>
<p>精简的访问控制列表包含的类型：</p>
<ul>
<li>拥有者：创建文件的用户</li>
<li>组：一组需要共享文件且具有类似访问的用户</li>
<li>其他：系统中所有其他用户</li>
</ul>
</li>
<li>
<p>口令指用户在建立一个文件时提供一个口令，系统为其建立FCB时附上相关口令，同时告诉允许共享该文件的其他用户。用户请求访问时必须提供相应的口令</p>
<p>缺点：口令直接存在系统内部，不够安全</p>
</li>
<li>
<p>密码指用户对文件进行加密，文件被访问时需要使用密钥。</p>
<p>优点：保密性强，节省了存储空间</p>
<p>缺点：编码和解码需要花费一定时间</p>
</li>
</ol>
<h3>文件的逻辑结构</h3>
<ol>
<li>
<p>逻辑结构：从用户角度出发所看到的文件的组织形式</p>
</li>
<li>
<p>按逻辑结构，文件可分为<strong>无结构文件</strong>和<strong>有结构文件</strong></p>
</li>
<li>
<p>无结构文件</p>
<ul>
<li>无结构文件/流式文件是最简单的文件组织形式，它是由字符流构成的文件，长度以字节为单位</li>
<li>对流式文件的访问，是通过读/写指针来指出下一个要访问的字节的</li>
<li>由于无结构文件没有结构，因而对记录的访问只能通过穷举搜索的方式</li>
</ul>
</li>
<li>
<p>有结构文件是指有一个以上的记录构成的文件，所以又称为记录式文件</p>
</li>
<li>
<p>有结构文件中各记录由相同或不同数目的数据项组成，根据各记录的长度是否相等，可分为定长记录和变长记录两种</p>
<ul>
<li>定长记录：文件中所有记录的长度都相等。各数据项都在记录中的相同位置，具有相同的长度</li>
<li>变长记录：文件中各记录的长度不一定相同，记录中的数据项数目以及数据项本身长度不一定相同</li>
</ul>
</li>
<li>
<p>有结构文件按记录的组织形式可分为顺序文件、索引文件、索引顺序文件</p>
<ul>
<li>
<p>顺序文件：文件中的记录一个接一个的顺序排列，记录可以是定长记录或变长记录。顺序文件中记录的排列有两种：</p>
<ul>
<li>串结构：各记录之间的顺序与关键字无关，通常是按存入的先后时间进行排列。查找时必须从头开始顺序依次查找，比较费时</li>
<li>顺序结构：所有记录按关键字顺序排列，对于定长记录的顺序文件，检索时可采用折半查找，效率较高</li>
</ul>
<p>在对记录进行批量操作时，顺序文件的效率是最高的；在经常需要查找、修改、增加或删除单个记录的场合，顺序文件的性能较差</p>
</li>
<li>
<p>索引文件：建立一张索引表，为主文件的每个记录在索引表中分别设置一个索引表项，其中包含指向记录的指针和记录长度，索引表按关键字排序，因此其本身也是一个定长记录的顺序文件。这样就将对变长记录顺序文件的顺序检索转变成对定长记录索引文件的随即检索，加快了检索速度</p>
</li>
<li>
<p>索引顺序文件：对文件中记录进行分组，为各分组中第一个记录建立索引表项。搜索时首先通过对索引表检索查找记录所在组，再在组中进行顺序检索</p>
</li>
</ul>
</li>
<li>
<p>直接文件或散列文件：给定记录的键值或通过散列函数转换的键值直接决定记录的物理位置</p>
</li>
</ol>
<h3>文件的物理结构</h3>
<ol>
<li>
<p>物理结构：文件存储在外存上的存储组织形式，对用户不可见</p>
</li>
<li>
<p>文件的物理地址就是研究文件的实现，即文件数据在物理存储设备上是如何分布和组织的</p>
</li>
<li>
<p>文件的分配方式：对磁盘分空闲块的管理<br>
文件存储空间管理：对磁盘空闲块的管理</p>
</li>
<li>
<p>常见的文件分配方式：连续分配、链接分配和索引分配</p>
</li>
<li>
<p>磁盘中的存储单元也被分为一个个的块，称为磁盘块，其大小通常与内存的页面大小相同。内存和磁盘之间的数据交换都是以块为单位进行的</p>
</li>
<li>
<p>连续分配</p>
<ul>
<li>连续分配方法要求每个文件在磁盘上占用一组连续的块。磁盘地址定义了磁盘上的一个线性排序，这种排序使进程访问磁盘时需要的寻道数和寻道时间最小</li>
<li>采用连续分配时，逻辑文件中的记录也顺序存储在相邻的物理块中。一个文件的目录项中应记录该文件的第一个磁盘块的块号和所占用的块数</li>
<li>优点：支持顺序访问和直接访问；顺序访问容易且速度快，文件所占用的块可能位于一条或几条相邻的磁道上，磁头的移动距离最小</li>
<li>缺点：要为一个文件分配连续的存储空间，会产生很多外部碎片，必须事先知道文件的长度，无法满足文件动态增长的需求，删除和插入记录时，需要移动相邻的记录</li>
</ul>
</li>
<li>
<p>链接分配</p>
<ul>
<li>
<p>优点：消除了磁盘的外部碎片，提高了磁盘的利用率；便于动态地为文件分配盘块，文件插入、删除和修改也很方便</p>
</li>
<li>
<p>隐式链接：目录项中含有文件的第一块的指针和最后一块的指针。每个文件对应磁盘块的链表，磁盘块分布在磁盘的任何地方</p>
<ul>
<li>缺点：只支持顺序访问，效率低；任何一块指针出现问题都会导致文件数据丢失；指向下一盘块的指针也要消耗一定的存储空间</li>
</ul>
</li>
<li>
<p>显式链接：将用于链接文件各物理块的指针，显式存放在内存的一张链接表中，该表在整个磁盘中仅设置一张，称为<strong>文件分配表FAT</strong>。每个表项中存放指向下一个盘块的指针。文件目录中只需记录文件的起始块号，后续块号可以通过FAT找到</p>
<markdown-accessiblity-table><table role="table">
<thead>
<tr>
<th align="center">盘块号</th>
<th align="center">下一块</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">-2</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">-1</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">……</td>
<td align="center">……</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p>FAT的表项与磁盘块一一对应，并且可以设置特殊的数字-1表示文件的最后一块，-2表示磁盘为空。</p>
<ul>
<li>优点：支持顺序访问，也支持直接访问，要访问第i块，无须访问前i-1块；FAT在系统启动时被读入内存，提高了检索速度，减少了访问磁盘的次数</li>
<li>缺点：FAT需要占用一定的内存空间</li>
</ul>
</li>
</ul>
</li>
<li>
<p>索引分配</p>
<ul>
<li>单级索引分配方法
<ul>
<li>为每个文件分配一个索引块，将分配给该文件的所有盘块号都记录在该索引块中</li>
<li>优点：支持直接访问，不产生外部碎片</li>
<li>缺点：索引块增加了额外的存储空间开销；文件太小时，索引块利用率低，文件太大时，若干索引块需要通过指针链接起来</li>
</ul>
</li>
<li>多级索引分配方式
<ul>
<li>当文件太大而索引块太多时，为这些索引块再建立一个索引块，称为<strong>主索引</strong>，便形成了二级索引分配方式</li>
<li>优点：加快了对大型文件的查找速度</li>
<li>缺点：访问一个盘块时，其所要启动磁盘的次数随着索引级数的增加而增多</li>
</ul>
</li>
<li>混合索引方式
<ul>
<li>小文件：将各个盘块地址直接放入PCB</li>
<li>中文件：采用单级索引分配</li>
<li>大文件：采用多级索引分配</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3>错题</h3>
<ol>
<li>
<p>打开文件操作的主要工作是(  )</p>
<p>A. 把指定文件的目录项复制到内存指定的区域</p>
<p>B. 把指定文件复制到内存指定的区域</p>
<p>C. 在指定文件所在的存储介质上找到指定文件的目录项</p>
<p>D. 在内存寻找指定的文件</p>
</li>
<li>
<p>关闭文件操作的主要工作是(  )</p>
<p>A. 将文件的最新信息从内存写回磁盘</p>
<p>B. 将文件当前的控制信息从内存写回磁盘</p>
<p>C. 将位示图从内存写回磁盘</p>
<p>D. 将超级块当前信息从内存写回磁盘</p>
</li>
<li>
<p>读文件操作的正确次序应该是(  )</p>
<p>I. 向设备驱动程序发出I/O请求，完成数据交换工作</p>
<p>II. 按存取控制说明检查访问的合法性</p>
<p>III. 根据目录项中该文件的逻辑和物理组织形式，将逻辑记录号转换为物理块号</p>
<p>IV. 按文件描述符在打开文件表中找到该文件的目录项</p>
<p>A. II、IV、III、I</p>
<p>B. IV、II、III、I</p>
<p>C. IV、III、II、I</p>
<p>D. II、IV、I、III</p>
</li>
<li>
<p>下列说法中，(  )属于文件的逻辑结构的范畴</p>
<p>A. 连续文件</p>
<p>B. 系统文件</p>
<p>C. 链接文件</p>
<p>D. 流式文件</p>
</li>
<li>
<p>逻辑文件存放在存储介质上时，采用的组织形式与(  )有关</p>
<p>A. 逻辑文件结构</p>
<p>B. 存储介质特性</p>
<p>C. 主存储器管理方式</p>
<p>D. 设备分配方式</p>
</li>
<li>
<p>若一个用户进程通过read系统调用读取一个磁盘文件中的数据，则下列关于此过程中的叙述中，正确的是(  )</p>
<p>I. 若该文件的数据不在内存，则该进程进入睡眠等待状态</p>
<p>II. 请求read系统调用会导致CPU从用户态切换到核心态</p>
<p>III. read系统调用参数应包含文件的名称</p>
<p>A. I、II</p>
<p>B. I、III</p>
<p>C. II、III</p>
<p>D. I、II和III</p>
</li>
<li>
<p>在一个文件被用户进程首次打开的过程中，操作系统需要做的是(  )</p>
<p>A. 将文件内容读到内存中</p>
<p>B. 将文件控制块读到内存中</p>
<p>C. 修改文件控制块中的读写权限</p>
<p>D. 将文件的数据缓冲区首指针返回给用户进程</p>
</li>
<li>
<p>若文件F仅被进程P打开并访问，则当进程P关闭F时，下列操作中，文件系统需要完成的是(  )</p>
<p>A. 删除目录中文件F的目录项</p>
<p>B. 释放F的索引节点所占的内存空间</p>
<p>C. 释放F的索引节点所占的外存空间</p>
<p>D. 文件磁盘索引节点中的链接计数减一</p>
</li>
</ol>
<h2>目录</h2>
<h3>目录的基本概念</h3>
<ol>
<li>目录检索的基本要求
<ul>
<li>实现“按名存取”</li>
<li>提高对目录的检索速度</li>
<li>在多用户系统中，应允许多个用户共享一个文件，因此目录还需要提供用于控制访问文件的信息</li>
<li>允许不同用户对不同文件采取相同的名字</li>
</ul>
</li>
</ol>
<h3>目录结构</h3>
<ol>
<li>单级目录结构
<ul>
<li>在整个文件系统中只建立一个目录表，每个文件占一个目录项</li>
<li>当建立一个新文件时，必须先检索所有目录项，以确保没有重名，然后在目录中增设一项，将新文件的属性信息填入该项</li>
<li>当访问一个文件时，先按文件名在该目录中查找到相应的FCB，经合法性检查后执行相应的操作</li>
<li>当删除一个文件时，先从该目录中找到该文件目录项，回收文件所占用的存储空间，然后清除目录项</li>
<li>优点：实现了“按名存取”</li>
<li>缺点：查找速度慢，文件不允许重名，不便于文件共享</li>
</ul>
</li>
<li>两级目录结构
<ul>
<li>将文件目录分为主文件目录MFD和用户文件目录UFD</li>
<li>主文件目录记录用户名及相应用户文件所在的存储位置</li>
<li>用户文件目录记录该用户所有文件的FCB</li>
<li>当某用户对文件进行访问时，只需搜索该用户对应的UFD，解决了不同用户文件重名问题，在一定程度上保证了文件的安全</li>
<li>优点：提高了检索速度，解决了多用户之间的文件重名问题，文件系统可以在目录上实现访问限制</li>
<li>缺点：两级目录结构缺乏灵活性，不能对文件分类</li>
</ul>
</li>
<li>树形目录结构
<ul>
<li>明显提高对目录的检索速度和文件系统的性能</li>
<li>当用户要访问某个文件时，用文件的路径名标识文件，文件路径名是个字符串，由从根目录出发到所找文件通路上所有目录名与数据文件名用分隔符“/”链接而成</li>
<li>优点：很方便地对文件进行分类，层次结构清晰，也能够更有效地进行文件的管理和保护。不同性质、不同用户的文件，可以分别呈现在系统目录树的不同层次或不同子树中，很容易赋予不同的存储权限</li>
<li>缺点：查找文件时，需要按路径逐级访问中间节点，增加了磁盘访问次数，影响查询速度</li>
</ul>
</li>
<li>无环图目录结构
<ul>
<li>在树形目录结构基础上增加一些指向同一结点的有向边，使整个目录称为一个有向无环图</li>
<li>允许目录共享子目录或文件，同一个文件或子目录可以出现在两个或多个目录中</li>
<li>为每个共享节点设置一个共享计数器，每当图中增加对该节点的共享链时，计数器加一；每当用户删除该节点时，计数器减一；仅当共享计数器为0时，才真正删除该节点，否则仅删除共享链</li>
</ul>
</li>
</ol>
<h3>目录的操作</h3>
<ol>
<li>搜索<br>
当用户使用一个文件时，需要搜索目录，已找到文件对应的目录项</li>
<li>创建文件<br>
当创建一个文件时，需要在目录中增加一个目录项</li>
<li>删除文件<br>
当删除一个文件时，需要在目录中删除相应的目录项</li>
<li>创建目录<br>
在树形目录结构中，用户可创建自己的用户文件目录，并可再创建子目录</li>
<li>删除目录
<ul>
<li>不删除非空目录，删除时要先删除目录中的所有文件，并递归地删除子目录</li>
<li>可删除非空目录，目录中的文件和子目录同时被删除</li>
</ul>
</li>
<li>移动目录<br>
将文件或子目录再不同的父目录之间移动</li>
<li>显示目录<br>
请求显示目录的内容</li>
<li>修改目录<br>
某些文件属性保存在目录中，因此这些属性的变化需要修改目录</li>
</ol>
<h3>目录实现</h3>
<ol>
<li>目录的基本实现方法有<strong>线性列表</strong>和<strong>哈希表</strong>两种</li>
<li>线性列表
<ul>
<li>当创建新文件时，首先搜索目录以确定没有同名文件存在，然后在目录中增加一个新的目录项</li>
<li>当删除文件时，根据给定的文件名搜索目录，然后释放分配给它的空间</li>
<li>当要重用目录项时，可以将目录项标记为不再使用，或将它加到空闲目录项列表中，还可以将目录的最后一个目录项复制到空闲位置，并减少目录长度</li>
</ul>
</li>
<li>哈希表
<ul>
<li>根据文件名得到一个值，并返回一个指向线性列表中元素的指针</li>
<li>优点：查找迅速，插入删除也很简单，但需要一些措施避免冲突</li>
</ul>
</li>
</ol>
<h3>文件共享</h3>
<ol>
<li>文件共享使多个用户共享同一文件，系统中只需要保留该文件的一个副本</li>
<li>当建立链接关系时，必须将被共享文件的物理地址复制到相应的目录。如果某个用户向该文件添加新数据，且需要增加新盘块，那么这些新增的盘块只出现在执行操作的目录中，对其他共享用户不可见</li>
<li>基于索引节点的共享方式/硬链接
<ul>
<li>将文件的物理地址和属性等信息不再放在目录项中，而是放在索引节点中，在文件目录中只设置文件名及指向相应索引节点的指针</li>
<li>在索引节点中还有一个链接计数count，称为引用计数，表示链接到本索引节点上的用户目录项的数目</li>
</ul>
</li>
<li>利用符号链实现文件共享/软连接
<ul>
<li>为使用户B能共享用户A的一个文件F，可由系统创建一个LINK类型文件L，并将文件写入用户B的目录，以实现B的目录与文件F的链接</li>
<li>文件L中只含有被链接文件F的路径名。当用户B访问L时，操作系统根据L中记录的路径名去查询文件F，然后对F进行读写操作</li>
<li>只有文件主才有指向其索引节点的指针，共向该文件的用户只有该文件的路径名。这样就避免了文件主删除文件后留下一个空指针的情况</li>
</ul>
</li>
<li>硬链接就是多个指针指向一个索引节点，保证只要还有一个指针指向索引节点，索引节点就不能删除；<br>
软连接就是将到达共享文件的路径保存，当要访问文件时，根据路径查找文件</li>
</ol>
<h3>错题</h3>
<ol>
<li>
<p>文件系统采用多级目录结构的目的是(  )</p>
<p>A. 减少系统开销</p>
<p>B. 节省存储空间</p>
<p>C. 解决命名冲突</p>
<p>D. 缩短传送时间</p>
</li>
</ol>
<h2>文件系统</h2>
<h3>文件系统结构</h3>
<ol>
<li>
<p>文件系统提供高效和便捷的磁盘访问，以便允许存储、定位、提取数据</p>
</li>
<li>
<p>文件系统有两个不同的设计问题：</p>
<ul>
<li>定义文件系统的用户接口，设计定义文件及其属性、所允许的文件操作、如何组织文件的目录结构</li>
<li>创建算法和数据结构，以便映射逻辑文件系统到物理外存设备</li>
</ul>
</li>
<li>
<p>文件系统层次结构</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">TB</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>应用程序<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">&lt;--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>逻辑文件系统<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">&lt;--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>文件组织模块<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">&lt;--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>基本文件系统<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">&lt;--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>I/O控制<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">&lt;--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>设备<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
<ul>
<li>I/O控制层：包括设备驱动程序和中断处理程序，在内存和磁盘系统之间传输信息。设备驱动程序将输入命令翻译成底层硬件的特殊指令，硬件控制器利用这些指令使I/O设备与系统交互</li>
<li>基本文件系统：向对应的设备驱动程序发送通用命令，以读取和写入磁盘的物理块。该层也管理内存缓冲区，并保存各种文件系统、目录和数据块的缓存</li>
<li>文件组织模块：组织文件及其逻辑块和物理块。文件组织模块可以将文件的逻辑块地址转换为物理块地址。该层还包括空闲空间管理器，以跟踪未分配的块</li>
<li>逻辑文件系统：用于管理文件系统中的元数据信息。元数据包括文件系统中的所有结构，而不包含实际数据。该系统管理目录结构，根据给定文件名提供相关信息。它通过FCB维护文件结构，同时还提供文件保护</li>
</ul>
</li>
</ol>
<h3>文件系统布局</h3>
<ol>
<li>文件系统存放在磁盘上，多数磁盘划分为一个或多个分区，每个分区中有一个独立的文件系统</li>
<li>文件系统包含信息：
<ul>
<li>主引导记录MBR：位于磁盘的0号扇区，用来引导计算机，MBR后面是分区表，该表给出了每个分区的起始和结束地址</li>
<li>引导块：MBR执行引导块内程序后，该程序负责启动该分区中的操作系统。每个分区都是统一从一个引导快开始</li>
<li>超级块：包含文件系统中的所有关键信息，在计算机启动或该文件系统首次使用时，超级块会被读入内存。包含分区的块的数量、块的大小、空闲块的数量和指针、空闲的FCB的数量和FCB的指针等</li>
<li>文件系统中空闲块的信息：可以用位视图或指针链接的形式给出</li>
</ul>
</li>
<li>文件系统在内存中的结构：
<ul>
<li>内存中的安装表包含每个已安装文件系统分区的有关信息</li>
<li>内存中的目录结构的缓存，包含最近访问目录的信息</li>
<li>整个系统的打开文件表，包含每个打开文件的FCB副本、打开计数及其他信息</li>
<li>每个进程的打开文件表，包含进程打开文件的文件描述符和指向整个系统的打开文件表中对应表项的指针</li>
</ul>
</li>
</ol>
<h3>外存空闲空间管理</h3>
<ol>
<li>
<p>一个磁盘可以划分多个分区，每个分区都可以有单独的文件系统</p>
</li>
<li>
<p>包含文件系统的分区通常称为卷。卷可以是磁盘的一部分，也可以是整个磁盘，还可以是多个磁盘组成的RAID集</p>
</li>
<li>
<p>在一个卷中，存放文件数据的空间(文件区)和FCB的空间(目录区)是分离的</p>
</li>
<li>
<p>卷在提供文件服务前，必须由对应的文件程序进行初始化，划分好目录区和文件区，建立空闲空间管理表格及存放卷信息的超级块</p>
</li>
<li>
<p>文件存储设备分成大小相同的物理块，并以块为单位交换信息</p>
</li>
<li>
<p>磁盘空闲空间管理的方法</p>
<div class="highlight highlight-source-mermaid"><pre class="notranslate"><span class="pl-k">graph</span> <span class="pl-c1">LR</span>
	<span class="pl-ent">A</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>方法<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">B</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>空闲表法<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">C</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>空闲链表法<span class="pl-pds"><span class="pl-sg">)</span></span></span><span class="pl-k">--&gt;</span><span class="pl-ent">F</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>空闲盘块链<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">C</span><span class="pl-k">--&gt;</span><span class="pl-ent">G</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>空闲盘区链<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">D</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>位示图法<span class="pl-pds"><span class="pl-sg">)</span></span></span>
	<span class="pl-ent">A</span><span class="pl-k">--&gt;</span><span class="pl-ent">E</span><span class="pl-s"><span class="pl-pds"><span class="pl-sg">(</span></span>成组链接法<span class="pl-pds"><span class="pl-sg">)</span></span></span></pre></div>
</li>
<li>
<p>空闲表法</p>
<ul>
<li>属于连续分配方式。系统为外存上的所有空闲区建立一张空闲表，每个空闲区对应一个空闲表项，其中包含表项序号、该空闲区的第一个空闲盘块号、该空闲区的空闲盘块数</li>
<li>盘块的分配：与内存的动态分配类似，也是采用首次适应算法、最佳适应算法等</li>
<li>盘块的回收：与内存回收类似，要考虑插入点前区和后区的相邻合并情况</li>
<li>优点：具有较高的分配速度，可减少访问磁盘的I/O频率</li>
</ul>
</li>
<li>
<p>空闲盘块链</p>
<ul>
<li>将磁盘上的所有空闲空间以盘块为单位拉成一条链。每个盘块都有指向下一个空闲盘块的指针。</li>
<li>盘块的分配：从链首开始，依此摘下适当数目的空闲盘块</li>
<li>盘块的回收：将回收的盘块依此插到空闲盘块链的末尾</li>
<li>优点：分配和回收过程简单</li>
<li>缺点：为一个文件分配盘块时可能要重复操作多次，效率较低，且空闲盘块链可能会很长</li>
</ul>
</li>
<li>
<p>空闲盘区链</p>
<ul>
<li>将磁盘上的所有空闲盘区拉成一条链</li>
<li>盘区的分配：首次适应算法等</li>
<li>盘区的回收：注意前区和后区的合并</li>
<li>优点：分配和回收的效率较高，且链长较短</li>
<li>缺点：分配和回收较复杂</li>
</ul>
</li>
<li>
<p>位示图法</p>
<ul>
<li>利用二进制的一位来表示磁盘中的一个盘块的使用情况，磁盘上的所有盘块都有一个二进制位与之对应。当值为0时，表示对应的盘块空闲，值为1时，表示对应的盘块已分配</li>
<li>盘块的分配：
<ol>
<li>顺序扫描位示图，从中找出一个或一组值为0的二进制位</li>
<li>将找到的一个或一组二进制位转化为与之对应的盘块号</li>
<li>修改位示图对应位置值为1</li>
</ol>
</li>
<li>盘块的回收：
<ol>
<li>将回收盘块号转换成位示图中的行号和列号</li>
<li>修改位示图对应位置值为0</li>
</ol>
</li>
<li>优点：很容易找到一个或一组相邻接的空闲盘块，占用空间小</li>
<li>缺点：位示图的大小会随着磁盘空间的增大而增大</li>
</ul>
</li>
<li>
<p>成组链接法</p>
<ul>
<li>将空闲盘块分成若干组，每组的第一个盘块记录下一组空闲盘块总数和空闲盘块号</li>
<li>盘块的分配：根据空闲盘块号栈的指针，将与之对应的盘块分配给用户，同时移动指针</li>
<li>盘块的回收：将回收的盘块号存入空闲盘块号栈的顶部，同时移动指针，并将栈中的空闲盘块数+1</li>
</ul>
</li>
</ol>
<h3>虚拟文件系统</h3>
<ol>
<li>VFS屏蔽了不同文件系统的差异和操作细节，向上为用户提供了文件操作的统一调用接口</li>
<li>当用户程序访问文件时，通过VFS提供的统一调用函数来操作不同文件系统的文件，而无需考虑具体的文件系统和实际的存储介质</li>
<li>为了实现VFS，系统抽象了四种对象类型
<ul>
<li>超级块对象：表示一个已安装的特定文件系统。超级块对象对应于磁盘上特定扇区的文件系统超级块，用于存储已安装文件系统的辕信息</li>
<li>索引节点对象：表示一个特定的文件，索引节点和文件一一对应，只有当文件被访问时，才在内存中创建索引节点对象，每个索引节点对象都会复制磁盘索引节点包含的一些数据</li>
<li>目录项对象：表示一个特定的目录项，目录项对象是一个路径的组成部分，包含指向关联索引节点的指针，还包含指向父目录和指向子目录的指针</li>
<li>文件对象：表示一个与进程相关的已打开文件</li>
</ul>
</li>
</ol>
<h3>文件系统挂载</h3>
<ol>
<li>文件系统在进程使用前必须先安装，也称挂载</li>
<li>将设备中的文件系统挂载到某个目录后，，就可通过这个目录来访问设备上的文件</li>
<li>访问时，操作系统找到了相应文件系统的指针，并遍历该设备的目录结构，以便查找指定的文件</li>
</ol>
<h3>错题</h3>
<ol>
<li>
<p>逻辑文件系统的功能有(  )</p>
<p>I. 文件按名存取</p>
<p>II. 文件目录组织管理</p>
<p>III. 把文件名转换为文件描述符或文件句柄</p>
<p>IV. 存储保护</p>
<p>A. I、II、III</p>
<p>B. II、III、IV</p>
<p>C. I、II、IV</p>
<p>D. I、II、III、IV</p>
</li>
<li>
<p>UNIX系统中，文件的索引结构存放在(  )</p>
<p>A. 超级块</p>
<p>B. 索引节点</p>
<p>C. 目录项</p>
<p>D. 空闲块</p>
</li>
<li>
<p>硬盘的主引导扇区(  )</p>
<p>A. 包含引导记录</p>
<p>B. 包含分区表和主引导记录</p>
<p>C. 只包含主引导记录</p>
<p>D. 只包含分区表</p>
</li>
<li>
<p>若用8个字(32位)组成的位示图保管内存，行号和列号均从1开始，假定用户归还一个块号为100的内存块，则它对应位示图的位置为(  )</p>
<p>A. 字号为3，位号为5</p>
<p>B. 字号为4，位号为4</p>
<p>C. 字号为3，位号为4</p>
<p>D. 字号为4，位号为5</p>
</li>
<li>
<p>比较难得到连续空间的空闲空间管理方式是(  )</p>
<p>A. 空闲链表</p>
<p>B. 空闲表</p>
<p>C. 位示图</p>
<p>D. 成组链接</p>
</li>
</ol></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://onebuaaer.us.kg/">我在人世间踽踽独行</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if("09/02/2024"!=""){
    var startSite=new Date("09/02/2024");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","wlkla/onebuaaer.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
<script> import mermaid from https://cdn.jsdelivr.net/npm/mermaid@11.1.0/+esm </script><script src='https://cdn.jsdelivr.net/npm/latex.js/dist/latex.mjs'></script><script src='https://onebuaaer.us.kg/lightbox.js'></script><script src='https://onebuaaer.us.kg/backtotop.js'></script><script src='https://onebuaaer.us.kg/lazyload.js'></script>

</html>
